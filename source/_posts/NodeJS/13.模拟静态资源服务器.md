---
title: 13.模拟静态资源服务器
tags: NodeJS
categories: NodeJS
date: 2017-11-1
---

```javascript
//引入http核心模块
var http = require("http");
var fs = require("fs");

var template = require("art-template");
var moment = require("moment");

//创建一个服务器对象
var server = http.createServer();

//开启服务器
server.on("request",function(req,res){
    //1.0接收请求的地址
    var url = req.url;
    //2.0判断：当请求根目录时，我们要将静态文件读取出来，响应回浏览器
    if(url == "/") {
        fs.readFile("./views/index.html",function(err,data){
            if(err) {
                return res.end("失败");
            }
            //3.0得到当前网站的所有的文件以及路径，并且将这些文件和路径进行遍历生成我们需要的html代码
            //得到所有的文件和路径
            fs.readdir("./",function(err,pathData){
                //判断所有的路径，是文件还是目录
                var fileArr = [];
                var dirArr = [];
                for(var i = 0; i < pathData.length; i++) {
                        (function(i) {
                            fs.stat(pathData[i],function(err,stats){
                                if(err) {
                                   return console.log("失败");
                                }
                                if(stats.isFile()) {
                                    fileArr.push({
                                        type: "file",
                                        name: pathData[i],
                                        size: stats.size,
                                        ctime: moment(stats.ctime).format("YYYY-MM-DD HH:mm:ss")
                                    });
                                } else {
                                    dirArr.push({
                                        type: "dir",
                                        name: pathData[i],
                                        ctime: moment(stats.ctime).format("YYYY-MM-DD HH:mm:ss")
                                    });
                                }
                                console.log(i);
                                if(i == pathData.length - 1) {
                                    var arr = dirArr.concat(fileArr);
                                    var render = template.compile(data.toString());
                                    //fs.readfile读取出来的data是一个十六进制的数组
                                    //但是template.compile后面需要传入一个字符串
                                    //所以在使用的时候需要转为字符串
                                    var html = render({
                                        arr: arr
                                    });
                                    res.end(html);
                                }
                            });
                        })(i);
                }

            //    //现在我们已经有了首页的内容，并且有了数据，但是我们需要将数据生成html代码放入到首页的内容中
            //   var render = template.compile(data.toString());
            //   //fs.readfile读取出来的data是一个十六进制的数组
            //   //但是template.compile后面需要传入一个字符串
            //   //所以在使用的时候需要转为字符串
            //   var html = render({
            //       arr: pathData
            //   });
            //   res.end(html);
            });
        });
    } 
});

//开启监听
server.listen("3000",function(){
   console.log("running"); 
});
```